\documentclass[10pt]{article}

\usepackage[margin=1in]{geometry}

\begin{document}

\begin{verbatim}
> set.seed(2)
> n = 10
> p = 5
> # total data matrix
> (Y = matrix(rnorm((n+1)*p), n+1, p))
             [,1]        [,2]         [,3]       [,4]        [,5]
 [1,] -0.89691455  0.98175278  1.589638200 -0.2841577  0.62249393
 [2,]  0.18484918 -0.39269536  1.954651642 -0.7766753  1.99092044
 [3,]  1.58784533 -1.03966898  0.004937777 -0.5956605 -0.30548372
 [4,] -1.13037567  1.78222896 -2.451706388 -1.7259798 -0.09084424
 [5,] -0.08025176 -2.31106908  0.477237303 -0.9025845 -0.18416145
 [6,]  0.13242028  0.87860458 -0.596558169 -0.5590619 -1.19876777
 [7,]  0.70795473  0.03580672  0.792203270 -0.2465126 -0.83828715
 [8,] -0.23969802  1.01282869  0.289636710 -0.3835862  2.06630136
 [9,]  1.98447394  0.43226515  0.738938604 -1.9591032 -0.56224705
[10,] -0.13878701  2.09081921  0.318960401 -0.8417051  1.27571551
[11,]  0.41765075 -1.19992582  1.076164354  1.9035475 -1.04757263
> 
> # yesterday's data matrix
> X = Y[1:n,]
> # new observation
> (z = matrix(Y[n+1,], p, 1))
           [,1]
[1,]  0.4176508
[2,] -1.1999258
[3,]  1.0761644
[4,]  1.9035475
[5,] -1.0475726
> 
> # current covariance matrix
> (X.cov = cov(X))
           [,1]       [,2]       [,3]       [,4]       [,5]
[1,]  0.9702007 -0.5221567  0.3169598 -0.1101524 -0.4093661
[2,] -0.5221567  1.7632303 -0.5536474 -0.1075466  0.3201142
[3,]  0.3169598 -0.5536474  1.4810250  0.3021300  0.5322165
[4,] -0.1101524 -0.1075466  0.3021300  0.3390944  0.1322887
[5,] -0.4093661  0.3201142  0.5322165  0.1322887  1.3410307
> # current inverse
> (X.inv = solve(X.cov))
           [,1]       [,2]       [,3]       [,4]       [,5]
[1,]  1.8345875  0.2367530 -0.7802207  1.0909617  0.7055427
[2,]  0.2367530  0.7870838  0.3020083  0.1552895 -0.2507884
[3,] -0.7802207  0.3020083  1.4732249 -1.1660299 -0.7799189
[4,]  1.0909617  0.1552895 -1.1660299  4.2595254  0.3385349
[5,]  0.7055427 -0.2507884 -0.7799189  0.3385349  1.2970677
> 
> Y.cov = cov(Y)
> # target
> (Y.inv = solve(Y.cov))
           [,1]       [,2]       [,3]       [,4]       [,5]
[1,]  1.9767290  0.2707238 -0.7970796  0.7780297  0.8201241
[2,]  0.2707238  0.8735854  0.3268898  0.2264766 -0.2831493
[3,] -0.7970796  0.3268898  1.5578820 -0.8042284 -0.9075330
[4,]  0.7780297  0.2264766 -0.8042284  1.6780026  0.6307776
[5,]  0.8201241 -0.2831493 -0.9075330  0.6307776  1.4199623
> 
> # calcule the c in B + cc'
> (c = sqrt(n+1)*(z - apply(Y, 2, mean)) / n)
            [,1]
[1,]  0.06226182
[2,] -0.46644200
[3,]  0.23046635
[4,]  0.82344260
[5,] -0.39954372
> 
> # note the equality
> (n-1)/n*X.cov + c %*% t(c)
            [,1]       [,2]       [,3]        [,4]       [,5]
[1,]  0.87705712 -0.4989826  0.2996130 -0.04786814 -0.3933058
[2,] -0.49898260  1.8044754 -0.6057818 -0.48088013  0.4744668
[3,]  0.29961304 -0.6057818  1.3860373  0.46169278  0.3869135
[4,] -0.04786814 -0.4808801  0.4616928  0.98324266 -0.2099415
[5,] -0.39330577  0.4744668  0.3869135 -0.20994150  1.3665628
> Y.cov
            [,1]       [,2]       [,3]        [,4]       [,5]
[1,]  0.87705712 -0.4989826  0.2996130 -0.04786814 -0.3933058
[2,] -0.49898260  1.8044754 -0.6057818 -0.48088013  0.4744668
[3,]  0.29961304 -0.6057818  1.3860373  0.46169278  0.3869135
[4,] -0.04786814 -0.4808801  0.4616928  0.98324266 -0.2099415
[5,] -0.39330577  0.4744668  0.3869135 -0.20994150  1.3665628
> 
> B.inv = n/(n-1)*X.inv
> 
> # special case of sherman-morrison-woodbury
> B.inv - (B.inv %*% c %*% t(c) %*% B.inv) / as.vector(1 + t(c) %*% B.inv %*% c)
           [,1]       [,2]       [,3]       [,4]       [,5]
[1,]  1.9767290  0.2707238 -0.7970796  0.7780297  0.8201241
[2,]  0.2707238  0.8735854  0.3268898  0.2264766 -0.2831493
[3,] -0.7970796  0.3268898  1.5578820 -0.8042284 -0.9075330
[4,]  0.7780297  0.2264766 -0.8042284  1.6780026  0.6307776
[5,]  0.8201241 -0.2831493 -0.9075330  0.6307776  1.4199623
> # is equal to todays inverse (used a check)
> Y.inv
           [,1]       [,2]       [,3]       [,4]       [,5]
[1,]  1.9767290  0.2707238 -0.7970796  0.7780297  0.8201241
[2,]  0.2707238  0.8735854  0.3268898  0.2264766 -0.2831493
[3,] -0.7970796  0.3268898  1.5578820 -0.8042284 -0.9075330
[4,]  0.7780297  0.2264766 -0.8042284  1.6780026  0.6307776
[5,]  0.8201241 -0.2831493 -0.9075330  0.6307776  1.4199623
\end{verbatim}

\end{document}
